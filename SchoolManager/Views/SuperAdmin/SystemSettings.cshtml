@model SchoolManager.ViewModels.SystemStatsViewModel
@{
    ViewData["Title"] = "Configuración del Sistema";
    Layout = "_SuperAdminLayout";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2><i class="bi bi-gear"></i> @ViewData["Title"]</h2>
            <p class="text-muted">Configuración general y parámetros del sistema</p>
        </div>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show">
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="row">
        <!-- Configuración de la Aplicación -->
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-sliders"></i> Configuración de la Aplicación</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label"><strong>Nombre del Sistema:</strong></label>
                        <input type="text" class="form-control" value="EduPlanner" readonly>
                    </div>

                    <div class="mb-3">
                        <label class="form-label"><strong>Versión:</strong></label>
                        <input type="text" class="form-control" value="1.0.0" readonly>
                    </div>

                    <div class="mb-3">
                        <label class="form-label"><strong>Ambiente:</strong></label>
                        <input type="text" class="form-control" value="@(Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT") ?? "Production")" readonly>
                    </div>

                    <div class="mb-3">
                        <label class="form-label"><strong>Base de Datos:</strong></label>
                        <input type="text" class="form-control" value="PostgreSQL (Render)" readonly>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estadísticas Rápidas -->
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-bar-chart"></i> Estadísticas del Sistema</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="p-3 bg-light rounded">
                                <h3 class="text-primary mb-0">@Model.TotalEscuelas</h3>
                                <small class="text-muted">Escuelas</small>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="p-3 bg-light rounded">
                                <h3 class="text-success mb-0">@Model.TotalUsuarios</h3>
                                <small class="text-muted">Usuarios</small>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="p-3 bg-light rounded">
                                <h3 class="text-info mb-0">@Model.TotalActividades</h3>
                                <small class="text-muted">Actividades</small>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="p-3 bg-light rounded">
                                <h3 class="text-warning mb-0">@Model.TotalMensajes</h3>
                                <small class="text-muted">Mensajes</small>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <a asp-action="SystemStats" class="btn btn-sm btn-outline-primary w-100">
                            <i class="bi bi-graph-up"></i> Ver Estadísticas Detalladas
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Acciones Rápidas -->
    <div class="row">
        <div class="col-md-4 mb-3">
            <div class="card h-100 border-primary">
                <div class="card-body text-center">
                    <i class="bi bi-database" style="font-size: 3rem; color: #0d6efd;"></i>
                    <h5 class="mt-3">Respaldo de Base de Datos</h5>
                    <p class="text-muted">Crear copias de seguridad del sistema</p>
                    <a asp-action="Backup" class="btn btn-primary">
                        <i class="bi bi-cloud-download"></i> Ir a Respaldos
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-3">
            <div class="card h-100 border-success">
                <div class="card-body text-center">
                    <i class="bi bi-shield-check" style="font-size: 3rem; color: #198754;"></i>
                    <h5 class="mt-3">Seguridad</h5>
                    <p class="text-muted">Configuración de seguridad global</p>
                    <a asp-controller="SecuritySetting" asp-action="Index" class="btn btn-success">
                        <i class="bi bi-lock"></i> Ver Configuración
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-3">
            <div class="card h-100 border-warning">
                <div class="card-body text-center">
                    <i class="bi bi-envelope-at" style="font-size: 3rem; color: #ffc107;"></i>
                    <h5 class="mt-3">Configuración de Email</h5>
                    <p class="text-muted">Gestionar configuraciones SMTP</p>
                    <a asp-controller="EmailConfiguration" asp-action="Index" class="btn btn-warning">
                        <i class="bi bi-envelope-gear"></i> Ver Configuración
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Información del Sistema -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-info-circle"></i> Información del Sistema</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Plataforma:</strong> .NET 8.0</p>
                            <p><strong>Framework:</strong> ASP.NET Core MVC</p>
                            <p><strong>Base de Datos:</strong> PostgreSQL</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>ORM:</strong> Entity Framework Core</p>
                            <p><strong>Hosting:</strong> Render.com</p>
                            <p><strong>Última Actualización:</strong> @DateTime.Now.ToString("dd/MM/yyyy")</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Botón volver -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <a asp-action="Index" class="btn btn-secondary btn-lg">
                <i class="bi bi-arrow-left"></i> Volver al Dashboard
            </a>
        </div>
    </div>
</div>

@functions {
    string GetRoleBadgeClass(string role)
    {
        return role?.ToLower() switch
        {
            "superadmin" => "bg-danger",
            "admin" => "bg-primary",
            "director" => "bg-info",
            "teacher" => "bg-success",
            "student" or "estudiante" => "bg-warning text-dark",
            _ => "bg-secondary"
        };
    }
}

