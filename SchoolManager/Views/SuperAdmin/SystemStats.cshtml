@model SchoolManager.ViewModels.SystemStatsViewModel
@{
    ViewData["Title"] = "Estadísticas del Sistema";
    Layout = "_SuperAdminLayout";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2><i class="bi bi-graph-up"></i> @ViewData["Title"]</h2>
            <p class="text-muted">Resumen general del sistema EduPlanner</p>
        </div>
    </div>

    <!-- Estadísticas Generales -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-primary mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Escuelas</h6>
                            <h2 class="mb-0">@Model.TotalEscuelas</h2>
                        </div>
                        <i class="bi bi-building" style="font-size: 3rem; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-white bg-success mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Usuarios Totales</h6>
                            <h2 class="mb-0">@Model.TotalUsuarios</h2>
                            <small>@Model.UsuariosActivos activos</small>
                        </div>
                        <i class="bi bi-people" style="font-size: 3rem; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-white bg-info mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Actividades</h6>
                            <h2 class="mb-0">@Model.TotalActividades</h2>
                        </div>
                        <i class="bi bi-journal-text" style="font-size: 3rem; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-white bg-warning mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Mensajes</h6>
                            <h2 class="mb-0">@Model.TotalMensajes</h2>
                        </div>
                        <i class="bi bi-envelope" style="font-size: 3rem; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Distribución por Roles -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-person-badge"></i> Distribución por Roles</h5>
                </div>
                <div class="card-body">
                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span><i class="bi bi-shield-check text-danger"></i> Administradores</span>
                            <strong>@Model.TotalAdmins</strong>
                        </div>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar bg-danger" style="width: @(Model.TotalUsuarios > 0 ? (Model.TotalAdmins * 100.0 / Model.TotalUsuarios).ToString("F1") : "0")%">
                                @(Model.TotalUsuarios > 0 ? (Model.TotalAdmins * 100.0 / Model.TotalUsuarios).ToString("F1") : "0")%
                            </div>
                        </div>
                    </div>

                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span><i class="bi bi-person-workspace text-primary"></i> Profesores</span>
                            <strong>@Model.TotalProfesores</strong>
                        </div>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar bg-primary" style="width: @(Model.TotalUsuarios > 0 ? (Model.TotalProfesores * 100.0 / Model.TotalUsuarios).ToString("F1") : "0")%">
                                @(Model.TotalUsuarios > 0 ? (Model.TotalProfesores * 100.0 / Model.TotalUsuarios).ToString("F1") : "0")%
                            </div>
                        </div>
                    </div>

                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span><i class="bi bi-mortarboard text-success"></i> Estudiantes</span>
                            <strong>@Model.TotalEstudiantes</strong>
                        </div>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar bg-success" style="width: @(Model.TotalUsuarios > 0 ? (Model.TotalEstudiantes * 100.0 / Model.TotalUsuarios).ToString("F1") : "0")%">
                                @(Model.TotalUsuarios > 0 ? (Model.TotalEstudiantes * 100.0 / Model.TotalUsuarios).ToString("F1") : "0")%
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-activity"></i> Actividad del Sistema</h5>
                </div>
                <div class="card-body">
                    <p><strong>Total de Calificaciones:</strong> @Model.TotalCalificaciones.ToString("N0")</p>
                    <p><strong>Usuarios Activos:</strong> @Model.UsuariosActivos</p>
                    <p><strong>Usuarios Inactivos:</strong> @Model.UsuariosInactivos</p>
                    <p><strong>Última Actividad:</strong> @Model.FechaUltimaActividad.ToString("dd/MM/yyyy HH:mm")</p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-bar-chart"></i> Promedios</h5>
                </div>
                <div class="card-body">
                    <p><strong>Promedio Actividades/Escuela:</strong> 
                        @(Model.TotalEscuelas > 0 ? (Model.TotalActividades / (double)Model.TotalEscuelas).ToString("F1") : "0")
                    </p>
                    <p><strong>Promedio Usuarios/Escuela:</strong> 
                        @(Model.TotalEscuelas > 0 ? (Model.TotalUsuarios / (double)Model.TotalEscuelas).ToString("F1") : "0")
                    </p>
                    <p><strong>Promedio Calificaciones/Actividad:</strong> 
                        @(Model.TotalActividades > 0 ? (Model.TotalCalificaciones / (double)Model.TotalActividades).ToString("F1") : "0")
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Estadísticas por Escuela -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-building"></i> Detalle por Escuela</h5>
                </div>
                <div class="card-body">
                    @if (Model.EscuelasStats != null && Model.EscuelasStats.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Logo</th>
                                        <th>Escuela</th>
                                        <th class="text-center">Usuarios</th>
                                        <th class="text-center">Estudiantes</th>
                                        <th class="text-center">Profesores</th>
                                        <th class="text-center">Actividades</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var escuela in Model.EscuelasStats)
                                    {
                                        <tr>
                                            <td>
                                                @if (!string.IsNullOrEmpty(escuela.LogoUrl))
                                                {
                                                    @if (escuela.LogoUrl.StartsWith("http"))
                                                    {
                                                        <img src="@escuela.LogoUrl" alt="Logo" style="max-height: 40px; max-width: 60px;" class="rounded">
                                                    }
                                                    else
                                                    {
                                                        <img src="/File/GetSchoolLogo?logoUrl=@escuela.LogoUrl" alt="Logo" style="max-height: 40px; max-width: 60px;" class="rounded">
                                                    }
                                                }
                                                else
                                                {
                                                    <i class="bi bi-building text-muted" style="font-size: 2rem;"></i>
                                                }
                                            </td>
                                            <td><strong>@escuela.Nombre</strong></td>
                                            <td class="text-center">@escuela.TotalUsuarios</td>
                                            <td class="text-center">@escuela.TotalEstudiantes</td>
                                            <td class="text-center">@escuela.TotalProfesores</td>
                                            <td class="text-center">@escuela.TotalActividades</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <p class="text-center text-muted">No hay escuelas registradas</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Botones de acción -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <a asp-action="Index" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver al Dashboard
            </a>
            <a asp-action="ActivityLog" class="btn btn-primary">
                <i class="bi bi-list-ul"></i> Ver Registro de Actividad
            </a>
        </div>
    </div>
</div>

